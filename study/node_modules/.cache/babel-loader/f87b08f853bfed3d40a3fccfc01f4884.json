{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { multiaddr } from '@multiformats/multiaddr';\n\nconst reduceValue = (_, v) => v;\n\nconst tcpUri = (str, port, parts, opts) => {\n  // return tcp when explicitly requested\n  if (opts != null && opts.assumeHttp === false) return `tcp://${str}:${port}`; // check if tcp is the last protocol in multiaddr\n\n  let protocol = 'tcp';\n  let explicitPort = `:${port}`;\n  const last = parts[parts.length - 1];\n\n  if (last.protocol === 'tcp') {\n    // assume http and produce clean urls\n    protocol = port === '443' ? 'https' : 'http';\n    explicitPort = port === '443' || port === '80' ? '' : explicitPort;\n  }\n\n  return `${protocol}://${str}${explicitPort}`;\n};\n\nconst Reducers = {\n  ip4: reduceValue,\n  ip6: (str, content, i, parts) => parts.length === 1 && parts[0].protocol === 'ip6' ? content : `[${content}]`,\n  tcp: (str, content, i, parts, opts) => parts.some(p => ['http', 'https', 'ws', 'wss'].includes(p.protocol)) ? `${str}:${content}` : tcpUri(str, content, parts, opts),\n  udp: (str, content) => `udp://${str}:${content}`,\n  dnsaddr: reduceValue,\n  dns4: reduceValue,\n  dns6: reduceValue,\n  ipfs: (str, content) => `${str}/ipfs/${content}`,\n  p2p: (str, content) => `${str}/p2p/${content}`,\n  http: str => `http://${str}`,\n  https: str => `https://${str}`,\n  ws: str => `ws://${str}`,\n  wss: str => `wss://${str}`,\n  'p2p-websocket-star': str => `${str}/p2p-websocket-star`,\n  'p2p-webrtc-star': str => `${str}/p2p-webrtc-star`,\n  'p2p-webrtc-direct': str => `${str}/p2p-webrtc-direct`\n};\nexport function multiaddrToUri(input, opts) {\n  const ma = multiaddr(input);\n  const parts = ma.toString().split('/').slice(1);\n  return ma.tuples().map(tuple => ({\n    protocol: parts.shift() ?? '',\n    content: tuple[1] != null ? parts.shift() ?? '' : ''\n  })).reduce((str, part, i, parts) => {\n    const reduce = Reducers[part.protocol];\n\n    if (reduce == null) {\n      throw new Error(`Unsupported protocol ${part.protocol}`);\n    }\n\n    return reduce(str, part.content, i, parts, opts);\n  }, '');\n}","map":{"version":3,"mappings":"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","names":["multiaddr","reduceValue","_","v","tcpUri","str","port","parts","opts","assumeHttp","protocol","explicitPort","last","length","Reducers","ip4","ip6","content","i","tcp","some","p","includes","udp","dnsaddr","dns4","dns6","ipfs","p2p","http","https","ws","wss","multiaddrToUri","input","ma","toString","split","slice","tuples","map","tuple","shift","reduce","part","Error"],"sourceRoot":"","sources":["../../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}